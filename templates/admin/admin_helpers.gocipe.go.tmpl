package admin

import (
    "context"
    "fmt"
    "time"
)

func setSlug(id string, value string, table string, field string) {
    suffix := ""
    max := 10
    tx, err := models.StartTransaction(context.Background())
	if err != nil {
		return
	}
    for i:=0;i<max;i++ {
        if i == max - 1 {
            now := time.Now()
            suffix = fmt.Sprintf("%d", now.Nanosecond())
        }

        stmt, err := tx.Prepare(`UPDATE ` + table + ` SET ` + field + ` = $1 WHERE id = $2`)
        if err != nil {
            continue
        }

        _, err = stmt.Exec(value + suffix, id)
        if err != nil {
            suffix = fmt.Sprintf("%02d", i + 1)
            continue
        }

	    err = tx.Commit()
        if err != nil {
            suffix = fmt.Sprintf("%02d", i + 1)
            continue
        }
    }
}